 # VS Code OpenAI Assistant - Проектная документация

## 1. Обзор проекта

### 1.1 Описание
VS Code OpenAI Assistant - это расширение для Visual Studio Code, которое интегрирует возможности OpenAI для анализа кода, помощи в разработке и исправления ошибок. Расширение предоставляет интуитивный интерфейс для взаимодействия с AI, позволяя разработчикам получать контекстно-зависимую помощь прямо в их IDE.

### 1.2 Цели проекта
- Упростить процесс разработки с помощью AI-ассистента
- Обеспечить быстрый доступ к подсказкам и исправлениям кода
- Интегрировать возможности OpenAI в рабочий процесс разработчика
- Предоставить контекстно-зависимую помощь на основе текущего кода

### 1.3 Ключевые заинтересованные стороны
- Разработчики (конечные пользователи)
- Команда разработки расширения
- OpenAI (поставщик API)
- Microsoft (платформа VS Code)

## 2. Бизнес-требования

### 2.1 Функциональные требования

#### 2.1.1 Основные функции
1. Интеграция с OpenAI API
   - Отправка запросов к API
   - Обработка ответов
   - Управление API ключом

2. Работа с файлами
   - Чтение содержимого файлов
   - Анализ текущего открытого файла
   - Выбор файла из списка открытых файлов
   - Отображение информации о выбранном файле

3. Пользовательский интерфейс
   - Текстовое поле для ввода запроса
   - Выпадающий список для выбора файла
   - Область отображения ответов
   - Поддержка Markdown в ответах

4. Анализ кода
   - Обнаружение проблем в коде
   - Предложение исправлений
   - Интерактивное применение исправлений

#### 2.1.2 Дополнительные функции
- Поддержка различных языков программирования
- История запросов и ответов
- Настройка параметров модели AI
- Кастомизация внешнего вида

### 2.2 Нефункциональные требования

#### 2.2.1 Производительность
- Время отклика UI < 100ms
- Время получения ответа от API < 5s
- Поддержка файлов размером до 100KB

#### 2.2.2 Безопасность
- Безопасное хранение API ключа
- Шифрование данных при передаче
- Валидация пользовательского ввода

#### 2.2.3 Надежность
- Обработка ошибок сети
- Восстановление после сбоев
- Сохранение состояния сессии

## 3. Технический дизайн

### 3.1 Архитектура системы

\`\`\`mermaid
graph TD
    A[VS Code Extension] --> B[WebView UI]
    A --> C[File System]
    A --> D[OpenAI API]
    B --> E[User Input]
    B --> F[Response Display]
    C --> G[File Management]
    D --> H[API Integration]
\`\`\`
<img width="738" alt="image" src="https://github.com/user-attachments/assets/4aad31d0-3956-4bea-8b15-fcf11fa0f080" />

### 3.2 Компоненты системы

#### 3.2.1 Extension Core
- Активация расширения
- Управление жизненным циклом
- Обработка команд VS Code

#### 3.2.2 WebView UI
- Пользовательский интерфейс
- Обработка событий
- Отображение результатов

#### 3.2.3 File Manager
- Работа с файловой системой
- Управление открытыми файлами
- Чтение содержимого файлов

#### 3.2.4 API Client
- Интеграция с OpenAI
- Управление запросами
- Обработка ответов

### 3.3 Диаграмма последовательности

\`\`\`mermaid
sequenceDiagram
    participant User
    participant UI
    participant Extension
    participant OpenAI
    
    User->>UI: Вводит запрос
    UI->>Extension: Отправляет запрос
    Extension->>OpenAI: Вызывает API
    OpenAI->>Extension: Возвращает ответ
    Extension->>UI: Обновляет интерфейс
    UI->>User: Показывает результат
\`\`\`
<img width="693" alt="image" src="https://github.com/user-attachments/assets/72aa78a7-d0d8-4f8a-a324-2e64d3182213" />


## 4. User Stories

### 4.1 Основные сценарии

#### US-1: Анализ кода
Как разработчик,  
Я хочу получить анализ моего кода,  
Чтобы улучшить его качество и найти потенциальные проблемы.

**Критерии приемки:**
- Возможность выбрать файл для анализа
- Получение понятных рекомендаций
- Возможность применить предложенные изменения

#### US-2: Контекстная помощь
Как разработчик,  
Я хочу получать помощь с учетом контекста текущего файла,  
Чтобы получать более релевантные ответы.

**Критерии приемки:**
- Автоматическое определение контекста
- Учет содержимого файла в запросах
- Возможность выбора файла для контекста

#### US-3: Управление файлами
Как разработчик,  
Я хочу иметь удобный доступ к открытым файлам,  
Чтобы быстро переключаться между ними при работе с AI.

**Критерии приемки:**
- Список всех открытых файлов
- Возможность выбора "без файла"
- Отображение текущего выбранного файла

## 5. Use Cases

### 5.1 Основные прецеденты

\`\`\`mermaid
graph TD
    A((Разработчик)) --> B[Отправить запрос]
    A --> C[Выбрать файл]
    A --> D[Применить исправления]
    B --> E[Получить ответ]
    C --> F[Обновить контекст]
    D --> G[Обновить код]
\`\`\`
<img width="731" alt="image" src="https://github.com/user-attachments/assets/d4aac7c5-63e4-4b26-bafc-8c8c4f786472" />

### 5.2 Детальные прецеденты

#### UC-1: Отправка запроса
**Актор:** Разработчик  
**Предусловия:** Расширение активировано  
**Основной поток:**
1. Разработчик выбирает файл из списка
2. Вводит текст запроса
3. Нажимает кнопку "Отправить"
4. Система отправляет запрос в OpenAI
5. Система отображает ответ

#### UC-2: Применение исправлений
**Актор:** Разработчик  
**Предусловия:** Получены предложения по исправлению  
**Основной поток:**
1. Система показывает предложенные изменения
2. Разработчик просматривает изменения
3. Разработчик применяет выбранные исправления
4. Система обновляет код

## 6. Интеграция с OpenAI API

### 6.1 Параметры API
- Модель: GPT-4
- Температура: 0.3
- Максимальные токены: Динамически
- Таймаут: 30 секунд

### 6.2 Формат запросов
\`\`\`typescript
interface ApiRequest {
    model: string;
    messages: Message[];
    temperature: number;
}

interface Message {
    role: 'user' | 'assistant';
    content: string;
}
\`\`\`

### 6.3 Обработка ответов
\`\`\`typescript
interface ApiResponse {
    choices: {
        message: {
            content: string;
        };
    }[];
}
\`\`\`

## 7. BPMN Процессы

### 7.1 Основной процесс работы

\`\`\`mermaid
graph LR
    A[Начало] --> B{Выбор файла}
    B --> |Нет файла| C[Ввод запроса]
    B --> |Выбран файл| D[Загрузка контекста]
    D --> C
    C --> E[Отправка в OpenAI]
    E --> F[Получение ответа]
    F --> G[Отображение результата]
    G --> H[Конец]
\`\`\`

### 7.2 Процесс обработки ошибок

\`\`\`mermaid
graph TD
    A[Ошибка] --> B{Тип ошибки}
    B --> |API| C[Повторная попытка]
    B --> |Сеть| D[Проверка соединения]
    B --> |Файл| E[Проверка доступа]
    C --> F[Уведомление пользователя]
    D --> F
    E --> F
\`\`\`

## 8. Технические спецификации

### 8.1 Стек технологий
- TypeScript
- VS Code Extension API
- WebView API
- OpenAI API
- Node.js

### 8.2 Зависимости
- vscode
- marked (для Markdown)
- node-fetch (для API запросов)

### 8.3 Структура проекта
\`\`\`
project/
├── src/
│   ├── web/
│   │   ├── components/
│   │   ├── services/
│   │   └── extension.ts
│   └── test/
├── docs/
└── package.json
\`\`\`

## 9. Дальнейшее развитие

### 9.1 Планируемые улучшения
- Поддержка нескольких моделей AI
- Сохранение истории запросов
- Кастомизация UI
- Интеграция с другими сервисами

### 9.2 Потенциальные расширения
- Поддержка командной работы
- Интеграция с системами контроля версий
- Расширенная аналитика кода
- Генерация документации

## 10. Заключение

Проект VS Code OpenAI Assistant представляет собой комплексное решение для интеграции AI-возможностей в процесс разработки. Документация охватывает все аспекты проекта от бизнес-требований до технической реализации и предоставляет четкое руководство для разработки и поддержки расширения.
